<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Adamus · Debug</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif; padding:20px; line-height:1.4; background:#f8fafc}
  h1{margin:0 0 16px}
  code{background:#eef; padding:2px 6px; border-radius:4px}
  .ok{color:#065f46}
  .err{color:#991b1b}
  .warn{color:#92400e}
  .card{background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; margin:12px 0; box-shadow:0 1px 2px rgba(0,0,0,.04)}
  table{border-collapse:collapse; width:100%}
  th,td{border-bottom:1px solid #e5e7eb; padding:8px; text-align:left; vertical-align:top}
  th{background:#f3f4f6}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace}
</style>
</head>
<body>
<h1>Adamus · Debug</h1>
<p>Deze pagina controleert of <code>subjects.json</code> en alle gekoppelde toetsbestanden bereikbaar en geldig zijn.</p>
<div id="out" class="card">Bezig met laden…</div>
<script>
(async function(){
  const out = document.getElementById('out');
  function line(html){ out.innerHTML += html; }
  out.innerHTML = '';
  try{
    const sRes = await fetch('subjects.json', {cache:'no-store'});
    line('<div><strong>subjects.json</strong>: ' + (sRes.ok?'<span class="ok">OK</span>':'<span class="err">FOUT '+sRes.status+'</span>') + '</div>');
    if(!sRes.ok){
      const t = await sRes.text().catch(()=>'');
      line('<pre class="mono">'+t.replace(/[&<>]/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;'}[c]))+'</pre>');
      return;
    }
    const subjects = await sRes.json().catch(e=>({__err:String(e)}));
    if(subjects.__err){ line('<div class="err">JSON parse error in subjects.json: '+subjects.__err+'</div>'); return; }
    const arr = subjects.subjects || subjects;
    if(!Array.isArray(arr)){ line('<div class="err">subjects.json heeft geen array "subjects".</div>'); return; }
    line('<div class="card"><div><strong>'+arr.length+'</strong> vak(ken) gevonden.</div></div>');
    // Tabel
    let html = '<table><tr><th>ID</th><th>Bestand</th><th>Status</th><th>Details</th></tr>';
    for(const meta of arr){
      const file = meta.file || meta.path;
      if(!file){ html += '<tr><td>'+ (meta.id||'') +'</td><td class="warn">–</td><td class="warn">GEEN pad</td><td>Voeg "file" toe.</td></tr>'; continue; }
      try{
        const r = await fetch(file, {cache:'no-store'});
        if(!r.ok){
          html += '<tr><td>'+ (meta.id||'') +'</td><td><code>'+file+'</code></td><td class="err">HTTP '+r.status+'</td><td>Bestand ontbreekt of pad klopt niet.</td></tr>';
          continue;
        }
        const data = await r.json().catch(e=>({__err:String(e)}));
        if(data.__err){
          html += '<tr><td>'+ (meta.id||'') +'</td><td><code>'+file+'</code></td><td class="err">Parse-fout</td><td>'+data.__err+'</td></tr>';
          continue;
        }
        let count = 0;
        if (meta.schema === 'toets'){
          // verwacht object met sleutel 'toets' met secties/vragen
          if(data && data.toets){
            // ruwe schatting
            for(const sect of data.toets){ if(sect && Array.isArray(sect.vragen)) count += sect.vragen.length; }
          }
        } else {
          if (Array.isArray(data)) count = data.length;
          if (data && Array.isArray(data.questions)) count = data.questions.length;
        }
        html += '<tr><td>'+ (meta.id||'') +'</td><td><code>'+file+'</code></td><td class="ok">OK</td><td>'+count+' vraag/vragen gevonden</td></tr>';
      }catch(e){
        html += '<tr><td>'+ (meta.id||'') +'</td><td><code>'+file+'</code></td><td class="err">Fout</td><td>'+String(e)+'</td></tr>';
      }
    }
    html += '</table>';
    line(html);
    line('<p class="warn">Tip: Zorg dat elk pad in <code>subjects.json</code> exact overeenkomt met de bestandsnaam en locatie op de server.</p>');
  }catch(e){
    line('<div class="err">Onverwachte fout: '+String(e)+'</div>');
  }
})();
</script>
</body>
</html>
